"use strict";(self.webpackChunkmyjscourse=self.webpackChunkmyjscourse||[]).push([[1858],{2633:function(e,n,t){t.r(n),t.d(n,{default:function(){return T}});var r=t(3905),l=t(7294);function a(e){const n=Object.assign({h1:"h1",p:"p",br:"br",strong:"strong",ul:"ul",li:"li",code:"code",pre:"pre",h2:"h2",a:"a"},(0,r.ah)(),e.components),{InternalPageMenu:t,PathViewer:a,PathViewerItem:o,InternalPageMenuItem:i,InternalPageTitle:u,YoutubeImage:c}=n;return t||s("InternalPageMenu",!0),i||s("InternalPageMenuItem",!0),u||s("InternalPageTitle",!0),a||s("PathViewer",!0),o||s("PathViewerItem",!0),c||s("YoutubeImage",!0),l.createElement(l.Fragment,null,l.createElement(n.h1,null,"b) Introduction au JSON et persistance des donnÃ©es"),"\n",l.createElement(t,null,l.createElement(a,null,l.createElement(o,{to:"/"}," web2course "),l.createElement(o,{to:"/part1"}," Partie 1 "),l.createElement(o,{selected:!0}," b) JSON ")),l.createElement(i,null," Le JSON, c'est quoi ? "),l.createElement(i,null," Communication de donnÃ©es en JSON Ã  une API "),l.createElement(i,null," Lecture et sauvegarde de donnÃ©es dans un fichier JSON par une API "),l.createElement(i,null," Exercice 1.7 : Persistance des donnÃ©es ")),"\n",l.createElement(n.h1,null,l.createElement(u,null," Le JSON, c'est quoi ? ")),"\n",l.createElement("div",{className:"card card__simple-youtube-container"},l.createElement(c,{src:"https://youtu.be/KR3bt4RBIQI"})),"\n",l.createElement(n.p,null,"PrÃ©cÃ©demment, nous avons dÃ©veloppÃ© notre premiÃ¨re RESTful API.",l.createElement(n.br),"\n","Nous avons implicitement dÃ©couvert le JSON, notamment lorsque nous avons fait des requÃªtes vers nos API."),"\n",l.createElement(n.p,null,"Nous allons maintenant voir ce que permet le JSON, notamment la crÃ©ation de fichiers permettant de sauvegarder des donnÃ©es facilement en JS."),"\n",l.createElement(n.p,null,l.createElement(n.strong,null,"JSON")," vient de ",l.createElement(n.strong,null,"J"),"ava",l.createElement(n.strong,null,"S"),"cript ",l.createElement(n.strong,null,"O"),"bject ",l.createElement(n.strong,null,"N"),"otation."),"\n",l.createElement(n.p,null,"C'est une syntaxe pour ",l.createElement(n.strong,null,"Ã©changer")," et ",l.createElement(n.strong,null,"faire persister des donnÃ©es"),"."),"\n",l.createElement(n.p,null,"Du JSON, c'est du texte en notation JS."),"\n",l.createElement(n.p,null,"Voici les types de donnÃ©es qui sont valides en JSON :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"string"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"number"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"object"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"array"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"boolean"))),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,l.createElement(n.code,null,"null"))),"\n"),"\n",l.createElement(n.p,null,"âš¡ Il n'y a donc pas de ",l.createElement(n.strong,null,l.createElement(n.code,null,"function")),", ",l.createElement(n.strong,null,l.createElement(n.code,null,"date"))," et ",l.createElement(n.strong,null,l.createElement(n.code,null,"undefined")),"."),"\n",l.createElement(n.p,null,"Voici un exemple de reprÃ©sentation de donnÃ©es en JSON qui correspond Ã  ce que trÃ¨s souvent une API renvoie, un array d'objets :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-json"},'[\r\n  {\r\n    "email": "raphael@voila.com",\r\n    "fullname": "Raphael Baroni"\r\n  },\r\n  {\r\n    "email": "jkj@herenqn.com",\r\n    "fullname": "JK Roling"\r\n  },\r\n  {\r\n    "email": "serena@gmail.com",\r\n    "fullname": "Serena Here"\r\n  }\r\n]\n')),"\n",l.createElement(n.h1,null,l.createElement(u,null," Communication de donnÃ©es en JSON Ã  une API ")),"\n",l.createElement(n.h2,null,"Introduction"),"\n",l.createElement(n.p,null,"Dans le tutoriel prÃ©cÃ©dent, nous avons communiquÃ© des donnÃ©es au format JSON :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"soit lors des requÃªtes via REST Client : nous avons envoyÃ© les donnÃ©es permettant de crÃ©er ou modifier une pizza :"),"\n",l.createElement(n.li,null,"soit lors du traitment des requÃªtes par l'API, afin de crÃ©er ou modifier les pizzas et les sauvegarder en mÃ©moire vive (dans un tableau d'objets)."),"\n"),"\n",l.createElement(n.p,null,"Nous allons maintenant approfondir comment les donnÃ©es au format JSON ont Ã©tÃ© traitÃ©es par l'API."),"\n",l.createElement(n.h2,null,"Envoi de donnÃ©es d'une API vers un client & sÃ©rialisation"),"\n",l.createElement(n.p,null,"Via Express, nous pouvons trÃ¨s facilement convertir un objet JS en JSON afin de l'envoyer vers une application cliente grÃ¢ce Ã  la mÃ©thode ",l.createElement(n.strong,null,l.createElement(n.code,null,"res.json()")),"."),"\n",l.createElement(n.p,null,"C'est ce que nous appelons de la ",l.createElement(n.strong,null,"sÃ©rialisation"),' de donnÃ©es : nous passons du monde "objets en mÃ©moire" vers du texte (ou des octets) qui va voyager sur un rÃ©seau.'),"\n",l.createElement(n.p,null,"Le code actuel de notre RESTful API, renvoyant un array de pizzas au format JSON, est gÃ©rÃ© automatiquement via :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"res.json(orderedMenu ?? MENU);\n")),"\n",l.createElement(n.p,null,"Lorsque l'API renvoie ",l.createElement(n.strong,null,l.createElement(n.code,null,"MENU"))," avec les pizzas par dÃ©faut, voici le JSON qui voyage sur le rÃ©seau :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-json"},'[\r\n  {\r\n    "id": 1,\r\n    "title": "4 fromages",\r\n    "content": "GruyÃ¨re, SÃ©rac, Appenzel, Gorgonzola, Tomates"\r\n  },\r\n  {\r\n    "id": 2,\r\n    "title": "Vegan",\r\n    "content": "Tomates, Courgettes, Oignons, Aubergines, Poivrons"\r\n  },\r\n  {\r\n    "id": 3,\r\n    "title": "Vegetarian",\r\n    "content": "Mozarella, Tomates, Oignons, Poivrons, Champignons, Olives"\r\n  },\r\n  {\r\n    "id": 4,\r\n    "title": "Alpage",\r\n    "content": "GruyÃ¨re, Mozarella, Lardons, Tomates"\r\n  },\r\n  {\r\n    "id": 5,\r\n    "title": "Diable",\r\n    "content": "Tomates, Mozarella, Chorizo piquant, Jalapenos"\r\n  }\r\n]\n')),"\n",l.createElement(n.p,null,"ðŸ’­ La puissance du JSON peut dÃ©jÃ  s'exprimer ici. Mais comment ?"),"\n",l.createElement(n.p,null,"L'API renvoie un array d'objets, des pizzas, au format JSON, qui correspond en fait Ã  un format texte avec des conventions.",l.createElement(n.br),"\n","Il est donc possible Ã  n'importe quelle application cliente d'utiliser ces donnÃ©es, quelque soit la technologie, le langage utilisÃ© pour dÃ©velopper cette application cliente.",l.createElement(n.br),"\n","Ainsi, par exemple, une application Android, dÃ©veloppÃ©e en Java, pourrait consommer cette API pour afficher un menu de pizzas !"),"\n",l.createElement(n.h2,null,"RÃ©ception de donnÃ©es d'un client par une API & parsing"),"\n",l.createElement(n.p,null,"Via Express, nous pouvons trÃ¨s facilement convertir du JSON vers un objet JS Ã  l'aide du middleware ",l.createElement(n.strong,null,l.createElement(n.code,null,"express.json()")),"."),"\n",l.createElement(n.p,null,"C'est ce que nous appelons du ",l.createElement(n.strong,null,"parsing")," de donnÃ©es, ou de la ",l.createElement(n.strong,null,"dÃ©sÃ©rialisation"),' : nous passons du monde texte / JSON (ou des octets) vers des "objets en mÃ©moire".'),"\n",l.createElement(n.p,null,"Le code actuel de notre RESTful API, rÃ©cupÃ©rant les donnÃ©es d'une pizza Ã  crÃ©er, est trÃ¨s simple :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"const title = req?.body?.title?.length !== 0 ? req.body.title : undefined;\r\nconst content = req?.body?.content?.length !== 0 ? req.body.content : undefined;\n")),"\n",l.createElement(n.p,null,"Automatiquement, grÃ¢ce Ã  Express et au middleware appelÃ© dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"apps.js"))," (",l.createElement(n.strong,null,l.createElement(n.code,null,"app.use(express.json());")),"), ",l.createElement(n.strong,null,l.createElement(n.code,null,"req.body"))," contient un objet JS reprÃ©sentant toutes les donnÃ©es JSON qui Ã©taient prÃ©sentes dans le body de la requÃªte cliente, comme par exemple :"),"\n",l.createElement(n.pre,{highlighting:"5-8"},l.createElement(n.code,{className:"language-http"},'### Create a pizza\r\nPOST {{baseUrl}}/pizzas\r\nContent-Type: application/json\r\n\r\n{\r\n    "title":"Magic Green",\r\n    "content":"Epinards, Brocolis, Olives vertes, Basilic"\r\n}\n')),"\n",l.createElement(n.p,null,'Il est important de communiquer le "',l.createElement(n.strong,null,"media type"),'" (ou ',l.createElement(n.strong,null,"MIME type"),") dans le corps de la requÃªte : ",l.createElement(n.strong,null,l.createElement(n.code,null,"application/json")),".",l.createElement(n.br),"\n","Cela indique Ã  l'application qui est la cible de la requÃªte (l'API dans notre cas) quelle genre d'outil elle devra utiliser pour dÃ©coder les donnÃ©es.",l.createElement(n.br),"\n","Par exemple, il faut faire un traitement diffÃ©rent pour rÃ©cupÃ©rer des donnÃ©es au format JSON que pour rÃ©cupÃ©rer des donnÃ©es directement associÃ©es Ã  un fichier image."),"\n",l.createElement(n.h1,null,l.createElement(u,null," Lecture et sauvegarde de donnÃ©es dans un fichier JSON par une API ")),"\n",l.createElement(n.h2,null,"Lecture de donnÃ©es se trouvant dans un fichier JSON"),"\n",l.createElement(n.p,null,"La fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"JSON.parse(objectSerialized) "))," permet de crÃ©er un objet JS Ã  partir d'une ",l.createElement(n.strong,null,l.createElement(n.code,null,"string"))," contenant des donnÃ©es au format JSON."),"\n",l.createElement(n.p,null,"Par exemple, voici une fonction, permettant Ã  une application Express de crÃ©er un objet JS en lisant des donnÃ©es se trouvant dans un fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,".json"))," dont le chemin et nom complet sont indiquÃ©s dans le paramÃ¨tre ",l.createElement(n.strong,null,l.createElement(n.code,null,"filePath"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"/**\r\n * Parse items given in a .json file\r\n * @param {String} filePath - path to the .json file\r\n * If the file does not exist or it's content cannot be parsed as JSON data,\r\n * use the default data.\r\n * @param {Array} defaultArray - Content to be used when the .json file does not exists\r\n * @returns {Array} : the array that was parsed from the file (or defaultData)\r\n */\r\nfunction parse(filePath, defaultArray = []) {\r\n  if (!fs.existsSync(filePath)) return defaultArray;\r\n  const fileData = fs.readFileSync(filePath);\r\n  try {\r\n    // parse() Throws a SyntaxError exception if the string to parse is not valid JSON.\r\n    return JSON.parse(fileData);\r\n  } catch (err) {\r\n    return defaultArray;\r\n  }\r\n}\n")),"\n",l.createElement(n.p,null,"Imaginez que plutÃ´t que de lire le menu de pizza Ã  partir d'un array d'objets, on souhaite lire ce menu grÃ¢ce au contenu d'un fichier contenant du JSON. Voici ce que donnerait l'opÃ©ration de lecture de toutes les pizzas si le chemin et nom complet du fichier JSON Ã©tait donnÃ© dans la constante ",l.createElement(n.strong,null,"jsonDbPath"),". :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"const jsonDbPath = __dirname + '/../data/pizzas.json';\r\n// Read all the pizzas from the menu\r\nrouter.get('/', function (req, res) {\r\n  console.log('GET /pizzas');\r\n  const pizzas = parse(jsonDbPath, DEFAULT_MENU);\r\n  res.json(pizzas);\r\n});\n")),"\n",l.createElement(n.h2,null,"Sauvegarde de donnÃ©es dans un fichier JSON"),"\n",l.createElement(n.p,null,"La fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"JSON.stringify(objectToSerialised)"))," permet de crÃ©er une ",l.createElement(n.strong,null,l.createElement(n.code,null,"string"))," contenant la reprÃ©sentation JSON de l'objet Ã  sÃ©rialiser."),"\n",l.createElement(n.p,null,"CÃ´tÃ© serveur, il est ensuite facile de sauvegarder les donnÃ©es JSON au sein d'un fichier."),"\n",l.createElement(n.p,null,"Par exemple, voici une fonction permettant Ã  une application Express de sauvegarder au format JSON un objet dans un fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,".json"))," dont son chemin et nom complet sont indiquÃ©s dans le paramÃ¨tre ",l.createElement(n.strong,null,l.createElement(n.code,null,"filePath"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"/**\r\n * Serialize the content of an Object within a file\r\n * @param {String} filePath - path to the .json file\r\n * @param {Array} object - Object to be written within the .json file.\r\n * Even if the file exists, its whole content is reset by the given object.\r\n */\r\nfunction serialize(filePath, object) {\r\n  const objectSerialized = JSON.stringify(object);\r\n  fs.writeFileSync(filePath, objectSerialized);\r\n}\n")),"\n",l.createElement(n.p,null,'Imaginez que, au sein du router traitant des ressources de type "pizzas", vous passiez la valeur suivante Ã  ',l.createElement(n.strong,null,l.createElement(n.code,null,"filePath"))," :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"const jsonDbPath = __dirname + '/../data/pizzas.json';\r\nserialize(jsonDbPath, MENU);\n")),"\n",l.createElement(n.p,null,"Cela signifie que dans le projet contenant notre API, nous allons sauvegarder le menu des pizzas au format JSON dans le fichier JSON ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/pizzas.json")),"."),"\n",l.createElement(n.p,null,"Ce fichier est en fait une ",l.createElement(n.strong,null,"base de donnÃ©es simplifiÃ©e")," !"),"\n",l.createElement(n.h2,null,"Persistance des donnÃ©es : d'une sauvegarde en mÃ©moire vive vers un fichier JSON"),"\n",l.createElement(n.p,null,'Nous allons maintenant rÃ©aliser un tutoriel pour rendre les ressources de type "pizzas" persistantes.',l.createElement(n.br),"\n","Nous allons repartir de l'API crÃ©Ã©e au tutoriel prÃ©cÃ©dent."),"\n",l.createElement(n.p,null,"Dans votre repo ",l.createElement(n.strong,null,l.createElement(n.code,null,"web2")),", veuillez copier / coller le rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/pizzeria/api/basic"))," et le renommer en ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/pizzeria/api/persistence")),"."),"\n",l.createElement(n.p,null,"En cas de souci, vous pouvez tÃ©lÃ©charger le code du tutoriel prÃ©cÃ©dent ici : ",l.createElement(n.a,{href:"https://github.com/e-vinci/js-demos/tree/main/backend-restful-api/restful-api-essentials/basic"},"api-basic"),"."),"\n",l.createElement(n.p,null,"Veuillez ouvrir un terminal au niveau de ce rÃ©pertoire."),"\n",l.createElement(n.p,null,"Pour la suite du tutoriel, nous considÃ©rons que tous les chemins absolus dÃ©marrent du rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/tutorials/pizzeria/api/persistence"))," (ou ",l.createElement(n.strong,null,l.createElement(n.code,null,"/web2/tutorials/pizzeria/api/persistence"))," si l'on considÃ¨re le nom du rÃ©pertoire du repo)."),"\n",l.createElement(n.p,null,"Veuillez crÃ©er un nouveau rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils")),". Au sein de ce rÃ©pertoire, veuillez crÃ©er le module ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils/json.js"))," dans lequel vous allez ajouter ces fonctions :"),"\n",l.createElement(n.pre,null,l.createElement(n.code,{className:"language-js"},"const fs = require('fs');\r\n\r\n/**\r\n * Parse items given in a .json file\r\n * @param {String} filePath - path to the .json file\r\n * If the file does not exist or it's content cannot be parsed as JSON data,\r\n * use the default data.\r\n * @param {Array} defaultArray - Content to be used when the .json file does not exists\r\n * @returns {Array} : the array that was parsed from the file (or defaultArray)\r\n */\r\nfunction parse(filePath, defaultArray = []) {\r\n  if (!fs.existsSync(filePath)) return defaultArray;\r\n  const fileData = fs.readFileSync(filePath);\r\n  try {\r\n    // parse() Throws a SyntaxError exception if the string to parse is not valid JSON.\r\n    return JSON.parse(fileData);\r\n  } catch (err) {\r\n    return defaultArray;\r\n  }\r\n}\r\n\r\n/**\r\n * Serialize the content of an Object within a file\r\n * @param {String} filePath - path to the .json file\r\n * @param {Array} object - Object to be written within the .json file.\r\n * Even if the file exists, its whole content is reset by the given object.\r\n */\r\nfunction serialize(filePath, object) {\r\n  const objectSerialized = JSON.stringify(object);\r\n  createPotentialLastDirectory(filePath);\r\n  fs.writeFileSync(filePath, objectSerialized);\r\n}\r\n\r\n/**\r\n *\r\n * @param {String} filePath - path to the .json file\r\n */\r\nfunction createPotentialLastDirectory(filePath) {\r\n  const pathToLastDirectory = filePath.substring(0, filePath.lastIndexOf('/'));\r\n\r\n  if (fs.existsSync(pathToLastDirectory)) return;\r\n\r\n  fs.mkdirSync(pathToLastDirectory);\r\n}\r\n\r\nmodule.exports = { parse, serialize };\n")),"\n",l.createElement(n.p,null,"L'opÃ©ration de sÃ©rialisation des donnÃ©es est faite via la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"serialize"))," de ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils/json.js")),". Pour se simplifier la vie et ne pas obliger les dÃ©veloppeurs Ã  devoir crÃ©er manuellement un rÃ©pertoire qui contiendra la mini DB de pizzas (le fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"pizzas.json"))," dans la suite de l'exemple), une fonction a Ã©tÃ© crÃ©Ã©e qui s'appelle ",l.createElement(n.strong,null,l.createElement(n.code,null,"createPotentialLastDirectory")),".",l.createElement(n.br),"\n","La fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"serialize"))," fait appel Ã  cette fonction qui va, si nÃ©cessaire, crÃ©er le dernier rÃ©pertoire donnÃ© dans le chemin vers le fichier JSON (le rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data"))," dans la suite de l'exemple)."),"\n",l.createElement(n.p,null,"Il n'est pas intÃ©ressant de retenir par coeur le code donnÃ© dans ",l.createElement(n.strong,null,l.createElement(n.code,null,"/utils/json.js")),". Par contre, il est important que vous compreniez celui-ci, ce qu'il fait."),"\n",l.createElement(n.p,null,'A prÃ©sent, nous allons convertir le code du router de "pizzas" pour rendre les donnÃ©es peristantes.',l.createElement(n.br),"\n","Voici ce que nous devons faire pour les opÃ©rations de :"),"\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"lecture de ressources")," : il suffit de faire appel Ã  la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse"))," qui tentera de charger les ressources qui devraient se trouver dans le rÃ©pertoire ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/pizzas.json")),". Notons que le chemin vers ce fichier JSON est un simple choix, il doit Ãªtre configurable."),"\n",l.createElement(n.li,null,l.createElement(n.strong,null,"Ã©criture de ressources")," : lors d'une opÃ©ration d'Ã©criture pour crÃ©er une nouvelle ressource, ou pour mettre Ã  jour une ressource existante, voici les Ã©tapes :","\n",l.createElement(n.ul,null,"\n",l.createElement(n.li,null,"crÃ©ation d'une liste de toutes les pizzas dans un array : cela correspond Ã  l'utilisation de la fonction ",l.createElement(n.strong,null,l.createElement(n.code,null,"parse"))," pour tenter de charger ce qui est contenu dans la mini DB de pizzas."),"\n",l.createElement(n.li,null,"mise Ã  jour de l'array soit en ajoutant un nouvel objet (une pizza), soit en modifiant un objet existant, soit en supprimant un objet."),"\n",l.createElement(n.li,null,"rÃ©Ã©criture complÃ¨te du fichier JSON contenant la liste de pizzas sur base de l'array de pizzas qui a prÃ©cÃ©demment Ã©tÃ© mis Ã  jour via la mÃ©thode ",l.createElement(n.strong,null,l.createElement(n.code,null,"serialize")),"."),"\n"),"\n"),"\n"),"\n",l.createElement(n.p,null,"Voici le code du router mis Ã  jour afin de gÃ©rer la persistance selon la stratÃ©gie dÃ©finie ci-dessus, les modifications Ã©tant surlignÃ©es :"),"\n",l.createElement(n.pre,{numbered:!0,highlighting:"2,5,45,47,51,58,60,64,76-78,87,89,98,100,104,107,123,125,129,131,133"},l.createElement(n.code,{className:"language-js"},"var express = require('express');\r\nconst { serialize, parse } = require('../utils/json');\r\nvar router = express.Router();\r\n\r\nconst jsonDbPath = __dirname + '/../data/pizzas.json';\r\n\r\nconst MENU = [\r\n  {\r\n    id: 1,\r\n    title: '4 fromages',\r\n    content: 'GruyÃ¨re, SÃ©rac, Appenzel, Gorgonzola, Tomates',\r\n  },\r\n  {\r\n    id: 2,\r\n    title: 'Vegan',\r\n    content: 'Tomates, Courgettes, Oignons, Aubergines, Poivrons',\r\n  },\r\n  {\r\n    id: 3,\r\n    title: 'Vegetarian',\r\n    content: 'Mozarella, Tomates, Oignons, Poivrons, Champignons, Olives',\r\n  },\r\n  {\r\n    id: 4,\r\n    title: 'Alpage',\r\n    content: 'GruyÃ¨re, Mozarella, Lardons, Tomates',\r\n  },\r\n  {\r\n    id: 5,\r\n    title: 'Diable',\r\n    content: 'Tomates, Mozarella, Chorizo piquant, Jalapenos',\r\n  },\r\n];\r\n\r\n/* Read all the pizzas from the menu\r\n   GET /pizzas?order=titleÂ :Â ascending orderÂ byÂ title\r\nÂ   GET /pizzas?order=-titleÂ :Â descending orderÂ byÂ title\r\n*/\r\nrouter.get('/', (req, res, next) => {\r\n  const orderByTitle =\r\n    req?.query?.order?.includes('title') ? req.query.order : undefined;\r\n  let orderedMenu;\r\n  console.log(`order by ${orderByTitle ?? 'not requested'}`);\r\n\r\n  const pizzas = parse(jsonDbPath, MENU);\r\n  \r\n  if (orderByTitle) orderedMenu = [...pizzas].sort((a, b) => a.title.localeCompare(b.title));\r\n  if (orderByTitle === '-title') orderedMenu = orderedMenu.reverse();\r\n\r\n  console.log('GET /pizzas');\r\n  return res.json(orderedMenu ?? pizzas);\r\n});\r\n\r\n// Read the pizza identified by an id in the menu\r\nrouter.get('/:id', (req, res) => {\r\n  console.log(`GET /pizzas/${req.params.id}`);\r\n\r\n  const pizzas = parse(jsonDbPath, MENU);\r\n\r\n  const indexOfPizzaFound = pizzas.findIndex(pizza => pizza.id == req.params.id);\r\n\r\n  if (indexOfPizzaFound < 0) return res.sendStatus(404);\r\n\r\n  return res.json(pizzas[indexOfPizzaFound]);\r\n});\r\n\r\n// Create a pizza to be added to the menu.\r\nrouter.post('/', (req, res) => {\r\n  const title = req?.body?.title?.length !== 0 ? req.body.title : undefined;\r\n  const content = req?.body?.content?.length !== 0 ? req.body.content : undefined;\r\n\r\n  console.log('POST /pizzas');\r\n\r\n  if (!title || !content) return res.sendStatus(400); // error code '400 Bad request'\r\n\r\n  const pizzas = parse(jsonDbPath, MENU);\r\n  const lastItemIndex = pizzas?.length !== 0 ? pizzas.length - 1 : undefined;\r\n  const lastId = lastItemIndex !== undefined ? pizzas[lastItemIndex]?.id : 0;\r\n  const nextId = lastId + 1;\r\n\r\n  const newPizza = {\r\n    id: nextId,\r\n    title: title,\r\n    content: content,\r\n  };\r\n\r\n  pizzas.push(newPizza);\r\n\r\n  serialize(jsonDbPath, pizzas);\r\n\r\n  return res.json(newPizza);\r\n});\r\n\r\n// Delete a pizza from the menu based on its id\r\nrouter.delete('/:id', (req, res) => {\r\n  console.log(`DELETE /pizzas/${req.params.id}`);\r\n\r\n  const pizzas = parse(jsonDbPath, MENU);\r\n\r\n  const foundIndex = pizzas.findIndex(pizza => pizza.id == req.params.id);\r\n\r\n  if (foundIndex < 0) return res.sendStatus(404);\r\n\r\n  const itemsRemovedFromMenu = pizzas.splice(foundIndex, 1);\r\n  const itemRemoved = itemsRemovedFromMenu[0];\r\n\r\n  serialize(jsonDbPath, pizzas);\r\n\r\n  return res.json(itemRemoved);\r\n});\r\n\r\n// Update a pizza based on its id and new values for its parameters\r\nrouter.patch('/:id', (req, res) => {\r\n  console.log(`PATCH /pizzas/${req.params.id}`);\r\n\r\n  const title = req?.body?.title;\r\n  const content = req?.body?.content;\r\n\r\n  console.log('POST /pizzas');\r\n\r\n  if ((!title && !content) || title?.length === 0 || content?.length === 0) return res.sendStatus(400);\r\n\r\n  const pizzas = parse(jsonDbPath, MENU);\r\n\r\n  const foundIndex = pizzas.findIndex(pizza => pizza.id == req.params.id);\r\n\r\n  if (foundIndex < 0) return res.sendStatus(404);\r\n\r\n  const updatedPizza = {...pizzas[foundIndex], ...req.body};\r\n\r\n  pizzas[foundIndex] = updatedPizza;\r\n\r\n  serialize(jsonDbPath, pizzas);\r\n\r\n  return res.json(updatedPizza);\r\n});\r\n\r\nmodule.exports = router;\n")),"\n",l.createElement(n.p,null,"Veuillez mettre Ã  jour votre fichier ",l.createElement(n.strong,null,l.createElement(n.code,null,"/router/pizzas.js"))," sur base du code donnÃ© et testez le bon fonctionnement de l'application. Faites quelques requÃªtes pour ajouter et modifier des donnÃ©es et vÃ©rifiez, une fois que vous redÃ©marrer votre application, que les donnÃ©es persistent."),"\n",l.createElement(n.h1,null,l.createElement(u,null," Exercice 1.7 : Persistance des donnÃ©es ")),"\n",l.createElement(n.p,null,"Vous allez mettre Ã  jour la RESTful API de ",l.createElement(n.strong,null,"myMovies")," afin de rendre les donnÃ©es persistantes dans un fichier JSON : ",l.createElement(n.strong,null,l.createElement(n.code,null,"/data/films.json")),"."),"\n",l.createElement(n.p,null,"Veuillez repartir du code de la solution de votre ",l.createElement(n.a,{href:"../express-api/#exercice_1_6_suppression_modification_de_ressources"},"Exercice 1.6"),".",l.createElement(n.br),"\n","Le code de votre application doit se trouver dans votre repository local et votre web repository (normalement appelÃ© ",l.createElement(n.strong,null,l.createElement(n.code,null,"web2")),") dans le rÃ©pertoire nommÃ© ",l.createElement(n.strong,null,l.createElement(n.code,null,"/exercises/1.7")),"."),"\n",l.createElement(n.p,null,"Veuillez tester toutes les fonctions de la RESTful API pour la collection de films Ã  l'aide de REST Client en copiant les requÃªtes dÃ©veloppÃ©es pour l'exercice prÃ©cÃ©dent (fichier ",l.createElement(n.strong,null,"films.http")," du rÃ©pertoire ",l.createElement(n.strong,null,"REST Client"),"). Normalement, il n'y a pas de nouvelles requÃªtes Ã  Ã©crire, il suffit juste de les exÃ©cuter."),"\n",l.createElement(n.p,null,"Veuillez faire un ",l.createElement(n.strong,null,l.createElement(n.code,null,"commit"))," de votre code avec le message suivant : ",l.createElement(n.strong,null,l.createElement(n.code,null,"1.7 : API : persistence")),"."))}var o=function(e){void 0===e&&(e={});const{wrapper:n}=Object.assign({},(0,r.ah)(),e.components);return n?l.createElement(n,e,l.createElement(a,e)):a(e)};function s(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}var i=t(4160),u=t(5583),c=t(5679),d=t(307),m=t(7410),p=t(9523),E=t(8075),f=t(9063),g=t(1631),z=t(5772),h=t(2770),v=t(7008),b=t(9771),j=t(1218),P=(t(5258),t(9394)),S=t(4579),y=t(7743),q=t(9256),I=t(6488),N=t(5175),x=t(6387),O=t(6044);const J={Link:i.Link,Image:c.Z,Section:d.Z,Content:m.Z,Background:p.Z,SectionHeader:E.Z,SectionFooter:f.Z,PageHeader:g.Z,CodeBlock:h.Z,LinkFile:v.Z,ScrollableImage:b.Z,PublicProjectsView:j.Z,AuthenticatedBlock:P.Z,UnAuthenticatedBlock:S.Z,NestedMdxBlock:y.Z,YoutubeImage:q.Z,InternalPageMenu:I.Z,InternalPageMenuItem:N.Z,InternalPageTitle:x.Z,PathViewer:O.k,PathViewerItem:O.F};function A(e){var n,t,a,o,s;let{data:{mdx:i,allImages:c},children:d}=e;return J.PageHeader=(0,z.u)(g.Z,null==i?void 0:i.frontmatter),l.createElement(u.Z,Object.assign({},null!=i&&i.frontmatter?{frontmatter:i.frontmatter}:{},null!=i&&null!==(n=i.frontmatter)&&void 0!==n&&n.navbarExtraStyles?{navbarExtraStyles:i.frontmatter.navbarExtraStyles}:{},null!=i&&null!==(t=i.frontmatter)&&void 0!==t&&t.headerImage?{headerImage:i.frontmatter.headerImage}:{},null!=i&&null!==(a=i.frontmatter)&&void 0!==a&&a.featuredImage?{featuredImage:i.frontmatter.featuredImage}:{},null!=i&&null!==(o=i.frontmatter)&&void 0!==o&&o.title?{pageTitle:i.frontmatter.title}:{},c&&c.length>0?{allImages:c}:{}),l.createElement(r.Zo,{components:J},l.createElement("div",{className:null!=i&&null!==(s=i.frontmatter)&&void 0!==s&&s.autoMargin?"page page--auto-margin ":"page"},d)))}function T(e){return l.createElement(A,e,l.createElement(o,e))}}}]);
//# sourceMappingURL=component---src-templates-mdx-pages-js-content-file-path-src-mdx-pages-part-1-json-fr-mdx-6027c3e39cc168bd827d.js.map