---
title: "DOM & interactions"
description: "JS dans un browser"
---

<PathViewer>
    <PathViewerItem to="/"> web2course </PathViewerItem>
    <PathViewerItem to="/part2"> Partie 2 </PathViewerItem>
    <PathViewerItem selected> b) DOM & interactions </PathViewerItem>
</PathViewer>

# b) Interactions avec le DOM

<InternalPageMenu>
  <InternalPageMenuItem> C'est quoi le DOM ? </InternalPageMenuItem>
  <InternalPageMenuItem> Comment acc√©der √† un √©l√©ment HTML en JS ? </InternalPageMenuItem>
  <InternalPageMenuItem> La programmation √©v√©nementielle </InternalPageMenuItem>
  <InternalPageMenuItem> Flux des √©v√©nements du DOM </InternalPageMenuItem>
  <InternalPageMenuItem> Les √©couteurs d'√©v√©nements </InternalPageMenuItem>
  <InternalPageMenuItem> Les callbacks & la programmation fonctionnelle </InternalPageMenuItem>
  <InternalPageMenuItem> Cr√©ation d'une IHM classique </InternalPageMenuItem>
  <InternalPageMenuItem> Exercice 2.2 : interaction avec le DOM </InternalPageMenuItem>
  <InternalPageMenuItem> L'objet event </InternalPageMenuItem>
  <InternalPageMenuItem> Exercice 2.3 : objet event & formulaire </InternalPageMenuItem>
  <InternalPageMenuItem> Exercice 2.4 : objet event & multiples √©l√©ments </InternalPageMenuItem>
  <InternalPageMenuItem> Les timers & actions </InternalPageMenuItem>
  <InternalPageMenuItem> Exercice 2.5 : timer pour lancer une action </InternalPageMenuItem>
  <InternalPageMenuItem> Les intervalles de temps & actions r√©p√©t√©es  </InternalPageMenuItem>
  <InternalPageMenuItem> Exercice 2.6 : s√©quence d'√©v√©nements diff√©r√©s dans le temps </InternalPageMenuItem>
</InternalPageMenu>


# <InternalPageTitle> C'est quoi le DOM ? </InternalPageTitle>

Le Document Object Model (DOM) est une structure de donn√©es, sous forme d'arbre, repr√©sentant les √©l√©ments HTML d'une page web.

Une page web est automatiquement r√©affich√©e quand une manipulation JS met √† jour un objet issu du DOM.

Le DOM donne acc√®s aux √©l√©ments HTML ainsi qu'√† leur style. Il est donc possible de mettre √† jour tant l'HTML que le CSS d'une page web.

<ScrollableImage name="dom2.png" minWidth="486px" maxWidth="500px" />

[HTML DOM Tree [R.22]](/references/#r22)

# <InternalPageTitle> Comment acc√©der √† un √©l√©ment HTML en JS ? </InternalPageTitle>

## Introduction

Il existe plusieurs moyens d'acc√©der √† un √©l√©ment HTML via des m√©thodes offertes par le DOM.  
Nous allons voir ensemble les fa√ßons les plus pratiques.

## `querySelector()`

Cette m√©thode retourne le 1er √©l√©ment qui correspond √† un s√©lecteur CSS.

Voici un exemple :

```html
<button id="myBtn2">Click¬†please</button>
<div class="message"></div>
```

Voici le code JS permettant d'acc√©der au √©l√©ments donn√©s ci-dessus :

```js
let btn2 = document.querySelector("#myBtn2"); //¬†HTML¬†id¬†attribute
let msg = document.querySelector(".message"); //¬†CSS class name
let duplicateMsg = document.querySelector("div"); //¬†HTML tag name
```

<br />

Les CSS s√©lecteurs sont importants en JS, tout comme en CSS :

- **`#`** : permet l'acc√®s via la propri√©t√© html **`id`**.
- **`.`** : permet l'acc√®s via une classe qui aurait √©t√© donn√©e √† l'√©l√©ment HTML (via la propri√©t√© **`class`**).
- **`TAG_NAME`** : permet l'acc√®s √† un √©l√©ment via le nom de la balise associ√©e √† l'√©l√©ment HTML.

<br />

Notons que pour modifier un √©l√©ment HTML pour lequel nous avons obtenu une r√©f√©rence, il suffit de changer une de ses propri√©t√©s. On utilise pour cela le nom des propri√©t√©s associ√©es √† l'√©l√©ment HTML.
Par exemple, si l'on souhaite changer le texte de **`btn2`**, il suffit de changer sa propri√©t√© **`innerText`** ou **`innerHTML`** :

```js
btn2.innerText = "I have been clicked";
```

Une fois cette ligne ex√©cut√©e par le browser, comme le DOM a √©t√© modifi√©, le bouton serait automatiquement r√©affich√© avec le nouveau texte `"I have been clicked"`.

## `getElementById()`

Cette m√©thode retourne l'√©l√©ment dont la propri√©t√© HTML nomm√©e **`id`** contient la valeur donn√©e en param√®tre.

Voici un exemple :

```html
<button id="myBtn1">Click¬†please</button>
```

Voici comment on pourrait acc√©der √† cet √©l√©ment :

```js
let btn1 = document.getElementById("myBtn1");
```

## `querySelectorAll()`

Cette m√©thode retourne tous les √©l√©ments qui correspondent √† un s√©lecteur CSS, sous forme d'une **`NodeList`**.

Voici un exemple :

```html
<button id="myBtn1">Click¬†please</button>
<button id="myBtn2">Click¬†please</button>
<button id="myBtn3">Click¬†please</button>
```

Voici comment on pourrait acc√©der √† ces √©l√©ments afin de mettre √† jour leurs textes :

```js
const buttons = document.querySelectorAll("button");
buttons.forEach((btn) => {
  btn.innerText = "Hacked!";
});
```

## Autres m√©thodes

Il existe bien s√ªr d'autres m√©thodes pour acc√©der aux √©l√©ments HTML.

Nous pensons que si vous retenez **`querySelector`** & **`querySelectorAll`**, il n'est pas n√©cessaire d'en conna√Ætre d'autres.

N√©anmoins, n'h√©sitez pas √† explorer [la documentation MDN sur l'interface Document](https://developer.mozilla.org/en-US/docs/Web/API/Document) [[23.]](/references/#r23).

# <InternalPageTitle> La programmation √©v√©nementielle </InternalPageTitle>

Pour r√©aliser une bonne IHM, nous allons faire de la programmation √©v√©nementielle. Nous allons √©crire du code pour d√©crire ce qui doit √™tre fait en fonction d'un clic, du passage d'une souris...

On va ajouter des √©couteurs d'√©v√©nements ("event listeners") sur des √©l√©ments du DOM pour d√©finir des actions qui seront √† r√©aliser une fois l'√©v√©nement soulev√©.

Vous avez d√©j√† exp√©riment√© des √©v√©nements qui am√®nent √† des actions par d√©faut, par exemple :

- lors d'un clic sur un bouton de type "submit" d'un formulaire : les donn√©es sont envoy√©es au serveur et la page est rafraichie.
- lors d'un clic sur un "hyperlink" : on est redirig√© vers une nouvelle page (o√π l'on voyage parfois aussi √† l'int√©rieur de la m√™me page).

Certains types d'√©v√©nements sont dits "cancelable events". Pour ces √©v√©nements, il est possible de stopper l'action par d√©faut. Nous allons prochainement d√©couvrir comment nous pourrions emp√™cher de rafraichir une page lors du clic sur le bouton "submit" d'un formulaire.

# <InternalPageTitle> Flux des √©v√©nements du DOM </InternalPageTitle>

Il est possible que plusieurs √©couteurs d'√©v√©nements soient actifs au sein d'une IHM.

Voici comment le browser traite les √©v√©nements :

1. Dans la phase de capture : l'√©v√©nement est captur√© et propag√© des √©l√©ments anc√™tres vers l'√©l√©ment cible de l'√©v√©nement.
2. Dans la "target phase" : l'√©v√©nement est g√©r√© par l'√©l√©ment cible.
3. Dans la "bubbling phase" : l'√©v√©nement est propag√© de l'√©l√©ment cible vers ses anc√™tres qui pourront eux-aussi g√©rer cet √©v√©nement si n√©cessaire.

<ScrollableImage name="eventflow.png" minWidth="480px" maxWidth="500px" />

[Flux de traitement d'un √©v√©nement [R.26]\_](/references/#r26)

# <InternalPageTitle> Les √©couteurs d'√©v√©nements </InternalPageTitle>
## Introduction

Il est possible de g√©rer des √©v√©nements de plusieurs fa√ßons.

## Via des m√©thodes

Vous pouvez ajouter des √©couteurs d'√©v√©nements √† l'aide de la m√©thode **`addEventListener()`**.

Vous pouvez enlever des √©couteurs d'√©v√©nements √† l'aide de la m√©thode **`removeEventListener()`**.

Voici un exemple :

```html
<html>
  <head>
    <title>Demo : click event management to update a button</title>
  </head>
  <body>
    <button id="myBtn1">Click please</button>
    <button id="myBtn2">Click please</button>
    <button id="myBtn3">Remove extra actions on button 2</button>
    <button id="myBtn4">Click please</button>
    <script src="index.js"></script>
  </body>
</html>
```

Voici comment on pourrait g√©rer des clics sur ces boutons :

```js
const btn1 = document.querySelector('#myBtn1');
const btn2 = document.querySelector('#myBtn2');
const buttons = document.querySelectorAll('button');
const btn3 = buttons[2]; // fancy way to get a reference...
const btn4 = document.querySelector('#myBtn4');

btn1.addEventListener('click', () => {
  btn1.innerText = 'myBtn1 : I have been clicked !';
  console.log('onClickHandlerForBtn1::click');
});
btn2.addEventListener('click', onClickHandlerForBtn2);
btn2.addEventListener('click', onClickHandlerForBtnExtra);
btn3.addEventListener('click', onClickHandlerForBtn3);

function onClickHandlerForBtn2() {
  btn2.innerText = 'myBtn2 : I have also been clicked';
  console.log('onClickHandlerForBtn2::click');
}

function onClickHandlerForBtn3() {
  btn2.removeEventListener('click', onClickHandlerForBtnExtra);
  console.log('onClickHandlerForBtn3::click');
}

function onClickHandlerForBtnExtra() {
  console.log('onClickHandlerForBtnExtra::click');
}

btn4.onclick = function() {
  btn4.innerText = 'myBtn4 : You clicked on me : )';
  console.log('onClickHandlerForBtn4::click');
};
```

N'h√©sitez pas √† ex√©cuter ce code.

Comment faire ?

Au sein de votre r√©pertoire **`/web2/tutorial`**, vous pourriez cr√©er un r√©pertoire **`dom-events`**, et y ajouter un fichier **`index.html`** contenant l'HTML ci-dessus.

Puis vous pourriez ajouter un fichier **`index.js`** contenant le JS ci-dessus.

Utilisez Live Server pour lancer **`index.html`** et acc√©dez √† la console de votre browser pour voir ce qui se passe lors de clic sur chacun des boutons.

## Via des propri√©t√©s

üëé Il est aussi possible d'ajouter des √©couteurs d'√©v√©nements √† l'aide de propri√©t√©s, mais nous ne le recommandons pas.

```js
btn4.onclick = function () {
  btn4.innerText = "You clicked on me : )";
  console.log("btn.onclick::anonymous function");
};
```

Sur internet, vous trouverez beaucoup d'exemples de gestion d'√©v√©nements √† l'aide de propri√©t√©s.

üëç Si vous veniez √† utiliser ce genre de code, nous vous recommandons un refactor vers l'utilisation de **`addEventListenner`**.

# <InternalPageTitle> Les callbacks & la programmation fonctionnelle </InternalPageTitle>

Les √©couteurs d'√©v√©nements ont besoin de pr√©ciser une action asynchrone, une action qui sera √† r√©aliser le moment venu.

Pour sp√©cifier cette action asynchrone, nous faisons ce que nous appelons de la programmation fonctionnelle.
A la fonction **`addEventListenner`**, nous lui passons en param√®tre une autre fonction que nous appelons une **`callback`**.

Une **`callback`** sera donc la fonction qui sera appel√©e le moment venu. Dans le cadre de la fonction **`addEventListenner`**, la **`callback`** sera appel√©e lorsque l'√©v√©nement sera trait√© par l'√©l√©ment HTML cible.

Dans ce code-ci :

```js numbered highlighting="7-13"
const btn1 = document.querySelector('#myBtn1');
const btn2 = document.querySelector('#myBtn2');
const buttons = document.querySelectorAll('button');
const btn3 = buttons[2]; // fancy way to get a reference...
const btn4 = document.querySelector('#myBtn4');

btn1.addEventListener('click', () => {
  btn1.innerText = 'myBtn1 : I have been clicked !';
  console.log('onClickHandlerForBtn1::click');
});
btn2.addEventListener('click', onClickHandlerForBtn2);
btn2.addEventListener('click', onClickHandlerForBtnExtra);
btn3.addEventListener('click', onClickHandlerForBtn3);

function onClickHandlerForBtn2() {
  btn2.innerText = 'myBtn2 : I have also been clicked';
  console.log('onClickHandlerForBtn2::click');
}

function onClickHandlerForBtn3() {
  btn2.removeEventListener('click', onClickHandlerForBtnExtra);
  console.log('onClickHandlerForBtn3::click');
}

function onClickHandlerForBtnExtra() {
  console.log('onClickHandlerForBtnExtra::click');
}

btn4.onclick = function() {
  btn4.innerText = 'myBtn4 : You clicked on me : )';
  console.log('onClickHandlerForBtn4::click');
};
```

On voit que les callback, le 2√®me param√®tre d'**`addEventListener`**, peuvent √™tre soit des fonctions "arrow" ou anonymes, soit des fonctions nomm√©es.

‚ö° Lorsque vous indiquez une callback, il est important que vous omettiez les parenth√®ses de la fonction. Sinon, cela ne fonctionnera pas ! Vous devez donner la d√©finition d'une fonction, pas l'appel d'une fonction !

# <InternalPageTitle> Cr√©ation d'une IHM classique </InternalPageTitle>
## Introduction

Tout au long du cours, nous d√©veloppons de mani√®re incr√©mentale, via une s√©rie de tutoriels, un site pour une pizzeria.

Dans votre repo **`web2`**, veuillez cr√©er le r√©pertoire **`/tutorials/pizzeria/hmi/classic`**.

Nous allons maintenant d√©velopper la version classique du site d'une pizzeria dans le dossier **classic**.

Veuillez ajouter dans le dossier **`classic`** ces 3 r√©pertoires :

- **`/tutorials/pizzeria/hmi/classic/img`** : c'est l√† que seront reprises les photos ;
- **`/tutorials/pizzeria/hmi/classic/sound`** : c'est l√† que les fichiers sonores seront ajout√©s ;
- **`/tutorials/pizzeria/hmi/classic/stylesheets`** : c'est l√† que le CSS sera donn√©.

Par la suite de ce tutoriel, nous consid√©rons que tous les chemins absolus d√©marrent du r√©pertoire **`/tutorials/pizzeria/hmi/classic`** (ou **`/web2/tutorials/pizzeria/hmi/classic`** si l'on consid√®re le nom du r√©pertoire du repo).

Veuillez ajouter ces 3 images dans **`/img`** :

- <LinkFile name="pizza.jpg" target="_blank" download>
    Photo √† utiliser comme background [R.29]
  </LinkFile>
- <LinkFile name="pizza-svgrepo-com.svg" target="_blank" download>
    SVG √† utiliser comme favicon (ou ic√¥ne de votre site web)
  </LinkFile>
- <LinkFile name="js-logo.png" target="_blank" download>
    Logo √† utiliser dans le footer
  </LinkFile>

Veuillez ajouter la musique du site dans **`/sound`** :

<LinkFile name="Infecticide-11-Pizza-Spinoza.mp3" target="_blank" download>Pizza Spinoza [R.30]</LinkFile>

<br/>
<br/>

## Les abr√©viations Emmet

Nous allons d'abord cr√©er la structure des √©l√©ments de la page au sein d'un nouveau fichier **`/index.html`**.

Pour g√©n√©rer le corps de sa page HTML, on peut utiliser une abr√©viation **Emmet** au sein de VS Code ; pour cela, commencez √† taper **`html:5`** et utilisez l'autocompletion (ou saisie automatique) dans le fichier **`index.html`** (il suffit de cliquer sur **`html:5`** qui appara√Æt dans la liste associ√©e √† l'autocompletion). Donnez le titre **Pizzeria** √† votre page web.

Les abr√©viations **Emmet** permettent donc d'automatiser l'√©criture d'HTML.

En savoir plus sur les abr√©viations **Emmet** : https://docs.emmet.io/abbreviations/ [[R.31]](/references/#r31)

## Cr√©ation de la structure de l'IHM

Nous allons ajouter un header, un main et un footer √† notre page web.

Le header reprendra un simple texte ("We love Pizza").

Le main contiendra seulement une balise **`audio`** pour offrir un lecteur contenant la chanson Pizza Spinoza.

Le footer pr√©sentera un texte ("But we also love JS") et le logo de JS.

Voici ce que devrait donner √† ce stade-ci votre **`index.html`** :

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pizzeria</title>
  </head>
  <body>
    <header>
      <h1>We love Pizza</h1>
    </header>

    <main>
      <audio id="audioPlayer" controls autoplay>
        <source
          src="./sound/Infecticide-11-Pizza-Spinoza.mp3"
          type="audio/mpeg"
        />
        Your browser does not support the audio element.
      </audio>
    </main>

    <footer>
      <h1>But we also love JS</h1>
      <img src="./img/js-logo.png" alt="" />
    </footer>
  </body>
</html>
```

Veuillez ex√©cuter cette page web. M√™me si ce n'est pas tr√®s esth√©tique, tous les √©l√©ments sont pr√©sents.

## Mise en forme

A l'aide de CSS, nous allons mettre en forme notre page web via un nouveau fichier √† cr√©er : **`/stylesheets/style.css`**.

Nous souhaitons que le layout de la page fasse toujours, au minimum, la hauteur compl√®te du navigateur ; pour ce faire nous allons :
- utiliser un body repris comme un un √©l√©ment Flexbox faisant 100% de hauteur.
- param√©trer le **`main`** pour lui permettre de remplir l'espace disponible.

Ainsi, le footer donnera l'effet d'√™tre "sticky" en bas de page.

De plus, nous allons ajouter **`pizza.jpg`** comme background de l'√©l√©ment **`html`**.

Voici le code de **`/stylesheets/style.css`** (veuillez l'ajouter dans votre fichier) :

```css
html, body {
    height: 100%;
    margin: 0;
}

body { 
    /*to easily deal with sticky footer*/
    display: flex;
    flex-direction: column;
    background-image : url(../img/pizza.jpg);
    background-size : cover;
}


header{
    text-align: center;
}

main{
    text-align: center;
     /*to easily deal with sticky footer:
     grow the main to fill the space*/
    flex: 1 0 auto;
}

footer{
    text-align: center;    
}

footer img {
    height: 50px;
}

footer h1{
    color: white;
}
```

Pour appliquer la stylesheet √† **`index.html`**, il suffit d'ajouter cette balise dans **`index.html`** √† la fin de la balise **`head`** :

```html
<link rel="stylesheet" href="./stylesheets/style.css" />
```

Pour ajouter cette balise, il est possible de juste taper l'abr√©viation **Emmet** "**`link:css`**" dans VS Code. Il ne reste plus qu'√† ajouter le chemin vers le fichier au sein de **`href`**. Dans la valeur de **`href`**, si vous tapez **`./`**, vous verrez tous les fichiers et r√©pertoires disponibles.

üëç Il est recommand√© d'utiliser un chemin relatif dans **`href`** et d'utiliser la saisie automatique (autocompletion) afin de ne pas se tromper dans l'√©criture du chemin d'un fichier.

Il est temps d'ajouter le fichier favicon comme logo pour notre site.

Tapez l'abr√©viation **Emmet** **`link:favicon`** √† la fin de la balise **`head`** d'**`index.html`**.  
Une balise de ce genre doit avoir √©t√© ajout√©e :

```html
<link
  rel="shortcut icon"
  href="./img/pizza-svgrepo-com.svg"
  type="image/svg+xml"
/>
```

La page web de la pizzeria devrait para√Ætre pas trop mal √† ce stade ci.

## Ajout d'interactivit√©

Nous souhaitons maintenant rendre cette page un peu plus interactive.

Nous nous sommes rendu compte que les clients de la pizzeria ont des difficult√©s √† cliquer juste sur le bouton Play/Pause du lecteur.

D√®s lors, nous allons permettre aux visiteurs de cliquer n'importe o√π sur la page pour d√©marrer ou stopper la musique.

Nous allons ajouter un script **`index.js`** g√©rant les clics des utilisateurs sur la page :

```js
const body = document.querySelector("body");

body.addEventListener("click", startOrStopSound);

function startOrStopSound() {
  const myAudioPlayer = document.querySelector("#audioPlayer");

  if (myAudioPlayer.paused) myAudioPlayer.play();
  else myAudioPlayer.pause();
}
```

Ici, √† l'aide d'un script JS et du DOM, nous pouvons acc√©der √† l'**`HTMLAudioElement`** contenu dans la page web. Nous avons ensuite acc√®s √† toutes les propri√©t√©s et fonctions mises √† disposition par cet objet.

Pour ajouter le fichier JS externe √† la page HTML √† la fin de la balise **`body`**, vous pouvez utiliser une abr√©viation **Emmet** "**`script:src`**" et il ne vous restera plus qu'√† indiquer le chemin vers **`index.js`** au sein de **`src`**.

```html
<script src="./index.js"></script>
```

Voila, vous devriez pouvoir bien ex√©cuter la **`HomePage`** du site de la pizzeria qui traite des clics n'importe o√π sur la page.

## Ajout d'une librairie externe

Nous souhaiterions ajouter une librairie externe √† notre application et l'utiliser afin d'afficher une petite animation sur notre **`HomePage`**.

Apr√®s quelques recherches dans google, nous d√©couvrons la librairie [Animate.css](https://animate.style/) [[R.32]](/references/#r32).

En lisant la documentation, nous voyons que pour ajouter la librairie √† notre application, il suffit d'ajouter cette balise √† une page HTML :

```html
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
/>
```

Et pour utiliser cette librairie, nous pouvons avoir un titre qui rebondit en utilisant une classe CSS de cette fa√ßon, directement au sein d'une page HTML :

```html
<h1 class="animate__animated animate__bounce">We love Pizza</h1>
```

Toujours en lisant la documentation, si nous souhaitons ajouter un d√©lai au rebondissement, nous pouvons le faire de cette fa√ßon, √† l'aide d'une classe CSS :

```html
<h1 class="animate__animated animate__bounce animate__delay-2s">
  But we also love JS
</h1>
```

Veuillez mettre √† jour votre page **`index.html`** :

```html numbered highlighting="9-12,16,36-38"
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pizzeria</title>
    <link rel="icon" href="./img/pizza-svgrepo-com.svg" type="image/svg+xml" />
    <link rel="stylesheet" href="./stylesheets/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
  </head>
  <body>
    <header>
      <h1 class="animate__animated animate__bounce">We love Pizza</h1>
    </header>

    <main>
      <p>My HomePage</p>
      <p>
        Because we love JS, you can also click on the header to stop / start the
        music ; )
      </p>

      <audio id="audioPlayer" controls autoplay>
        <source
          src="./sound/Infecticide-11-Pizza-Spinoza.mp3"
          type="audio/mpeg"
        />
        Your browser does not support the audio element.
      </audio>
    </main>

    <footer>
      <h1 class="animate__animated animate__bounce animate__delay-2s">
        But we also love JS
      </h1>
      <img src="./img/js-logo.png" alt="" />
    </footer>

    <script src="./index.js"></script>
  </body>
</html>
```

Nous avons tr√®s facilement ajout√© deux animations √† notre application web sans effort, en nous reposant sur une librairie externe.

Si tout fonctionne bien, faites un commit de votre repo (**`web2`**) avec comme message : **`classic-hmi tutorial`**.

En cas de souci, vous pouvez acc√©der au code final de ce tutorial ici : [classic-hmi](https://github.com/e-vinci/js-demos/tree/main/frontend/frontend-essentials/classic-hmi).


# <InternalPageTitle> Exercice 2.2 : interaction avec le DOM </InternalPageTitle>

Veuillez r√©aliser une application web permettant d'afficher un compteur de clics sur votre page web.

Affichez le message suivant sur votre page web :
- Au 5√®me clic jusqu'au 9√®me clic : *"Bravo, bel √©chauffement !"*
- Au 10√®me clic et au-del√† : *"Vous √™tes pass√© ma√Ætre en l'art du clic !"*

N'oubliez pas, bien s√ªr, d'afficher le compteur de clics sur votre page.

Veuillez cr√©er un nouveau projet dans votre repository local et votre web repository (normalement appel√© **`web2`**) nomm√© **`/exercises/2.2`**.  Quand votre application est finalis√©e, veuillez faire un **`commit`** de votre code avec comme message : **`2.2 : HMI : dom interaction`**.

#### ü§ù Tips

- Vous avez besoin d'un container pour afficher de l'information.
  Vous pouvez utiliser la propri√©t√© **`innerHtml`** ou **`textContent`** d'un paragraphe **`<p>`** ou d'un **`<span>`** pour afficher votre compteur.
- Vous pouvez faire de m√™me pour afficher votre message.
- Vous pouvez ajouter un gestionnaire d'√©v√©nement sur l'objet **`window`** de votre navigateur.

# <InternalPageTitle> L'objet event </InternalPageTitle>

L'objet **`event`** est automatiquement pass√© √† la callback d'un √©couteur d'√©v√©nement.

Il est tr√®s utile, pour deux raisons principalement :

- Stopper l'action par d√©faut suite √† un √©v√©nement.
- Lorsqu'on attache une m√™me callback √† une multitude d'√©l√©ments, pour retrouver la cible de l'√©v√©nement.

Voici un exemple o√π l'on souhaite d√©couvrir l'id de la **`div`** lorsque la souris quitte celle-ci. **`index.html`** contient 6 divs :

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Demo : mouse-over event management to update a div</title>
    <link rel="stylesheet" href="./main.css">

<body>

    <div class="message" id="msgBox1">
        Waiting for the call to a welcome function...
    </div>

    <div class="message" id="msgBox2">
        Waiting for the call to a welcome function...
    </div>

    <div class="message" id="msgBox3">
        Waiting for the call to a welcome function...
    </div>

    <div class="message" id="msgBox4">
        Waiting for the call to a welcome function...
    </div>

    <div class="message" id="msgBox5">
        Waiting for the call to a welcome function...
    </div>

    <div class="message" id="msgBox6">
        Waiting for the call to a welcome function...
    </div>

    <script src="index.js" ></script>

</body>
</html>
```

Un peu de style pour bien visualiser les 6 divs au sein de **`main.css`** :

```css
.message {
  padding: 1rem;
  margin: 1rem;
  border: solid 1px black;
}
```

Voici comment on pourrait g√©rer les mouvements de la souris au sein de **`index.js`** :

```js highlighting="8-9"
const divs = document.querySelectorAll(".message");

divs.forEach((div) => {
  div.addEventListener("mouseover", () => {
    div.innerText = "Hello world!";
  });

  div.addEventListener("mouseout", (e) => {
    div.innerText = `You have left the div wit id ${e.target.id}`;
  });
});
```

L'objet **`event`** a √©t√© nomm√© **`e`** ici, mais nous aurions pu lui donner le nom que l'on souhaitait.

üëç Pour √©viter la confusion, il est recommand√© de l'appeler **`e`** (ou √©ventuellement **`event`**).

**`e.target`** est l'√©l√©ment HTML qui lance la propagation de l'√©v√©nement dans le DOM tree.

Parfois on pr√©f√®re utiliser **`e.currentTarget`** qui est l'√©l√©ment HTML sur lequel est attach√© l'√©couteur d'√©v√©nements.

N'h√©sitez pas √† ex√©cuter le code ci-dessus, si vous le souhaitez, en cr√©ant les 3 fichiers n√©cessaires.

Voici un exemple partiel de gestion de formulaire o√π l'on utilise l'objet **`event`** pour stopper l'action par d√©faut qui est d'envoyer les donn√©es au serveur (indiqu√© par la propri√©t√© **`action`** du formulaire) et de recharger la page :

```js highlighting="3,5"
// code to get the reference to the form shall be imagined

const onSubmit = (e) => {
  console.log("onSubmit::");
  e.preventDefault();
};

myForm.addEventListener("submit", onSubmit);
```

# <InternalPageTitle> Exercice 2.3 : objet event & formulaire </InternalPageTitle>

Veuillez r√©aliser une application web permettant d'afficher un formulaire demandant votre souhait de l'instant et un bouton pour le soumettre.

Veuillez cr√©er un nouveau projet dans votre repository local et votre web repository (normalement appel√© **`web2`**) nomm√© **`/exercises/2.3`**.

Lorsqu'on clique pour soumettre son souhait, veuillez faire dispara√Ætre le formulaire et afficher le souhait soumis. Attention, vous devez vous assurer que la page n'est pas recharg√©e lors de la soumission du formulaire.

Quand votre application est finalis√©e, veuillez faire un **`commit`** de votre code avec comme message : **`2.3 : event object & form`**.

#### ü§ù Tips

- Pour faire dispara√Ætre un container (une **`div`** par exemple), vous pourriez utiliser sa propri√©t√© **`style.display`** et la mettre √† **`none`**.
- Pour faire appara√Ætre du contenu dans un container, (une **`div`** par exemple), vous pourriez utiliser sa propri√©t√© **`innerText`**.

# <InternalPageTitle> Exercice 2.4 : objet event & multiples √©l√©ments </InternalPageTitle>

Veuillez r√©aliser une application web permettant d'afficher la couleur associ√©e √† une div parmi environ un millier de divs.

Veuillez cr√©er un nouveau projet dans votre repository local et votre web repository (normalement appel√© **`web2`**) nomm√© **`/exercises/2.4`**.

La page HTML contenant environ un millier de divs vous est offerte :
<LinkFile name="many-divs.html" target="_blank" download> Fichier HTML de base </LinkFile>

Il ne vous reste plus qu'√† ajouter l'interactivit√© : 
- Quand on clique sur une div, vous devez l'agrandir et afficher √† l'int√©rieur sa couleur.
- Vous devez faire cela en utilisant l'objet **`event`**.

Quand votre application est finalis√©e, veuillez faire un **`commit`** de votre code avec comme message : **`2.4 : event object & multiple divs`**.

#### ü§ù Tips

- N'h√©sitez pas √† r√©cup√©rer une liste de toutes les divs via **`querySelectorAll`**.
- Vous pourriez, sur base de cette liste, attacher un √©couteur de clics sur chaque div : **`addEventListener`**.
- La callback pass√©e √† **`addEventListener`** vous donne acc√®s √† la cible de l'√©v√©nement via l'objet **`event`**.

# <InternalPageTitle> Les timers & actions </InternalPageTitle>

**`setTimeout(f,t)`** permet l'ex√©cution d'une callback **`f`** √† l'expiration d'un timer, apr√®s **`t`** ms.

**`clearTimeout()`** permet de stopper l'ex√©cution d'une callback qui a √©t√© appel√©e via **`setTimeout()`**.

Voici un exemple :

```html
<html>
  <head>
    <title>Demo : timer management</title>
  </head>
  <body>
    <button id="myBtn1">Show pop-up after 2s timer</button>
    <button id="myBtn2">Clear planned action</button>
    <script src="index.js"></script>
  </body>
</html>
```

```js numbered highlighting="7,12-14,18"
const btn1 = document.querySelector("#myBtn1");
const btn2 = document.querySelector("#myBtn2");

btn1.addEventListener("click", delayedAlert);
btn2.addEventListener("click", clearAlert);

let timeoutID;
const delayInSeconds = 2;
const delayInMiliSeconds = delayInSeconds * 1000;

function delayedAlert() {
  timeoutID = setTimeout(() => {
    alert(`You asked for this popup ${delayInSeconds}s ago!`);
  }, delayInMiliSeconds);
}

function clearAlert() {
  clearTimeout(timeoutID);
}
```

N'h√©sitez pas √† ex√©cuter ce code, si vous le souhaitez, en cr√©ant les 2 fichiers n√©cessaires.

Normalement, si vous cliquez sur le 1<sup>er</sup> bouton, puis avant deux secondes sur le deuxi√®me bouton, aucun pop-up ne sera lanc√©.


# <InternalPageTitle> Exercice 2.5 : timer pour lancer une action </InternalPageTitle>

Veuillez r√©aliser une application web permettant d'afficher le temps qu'il faut pour qu'un utilisateur clique 10 fois sur un bouton : 
- Le jeu d√©marre d√®s que la souris de l'utilisateur passe sur le bouton.
- Si 5 secondes apr√®s que l'utilisateur soit pass√© sur le bouton, l'utilisateur n'a pas termin√© son 10<sup>√®me</sup> clic, veuillez afficher un message de type : *"Game over, you did not click 10 times within 5s !"*.
- Si l'utilisateur a termin√© ses 10 clics avant 5s, veuillez afficher :* "You win ! You clicked 10 times within X ms"* o√π X est une valeur enti√®re.

Veuillez cr√©er un nouveau projet dans votre repository local et votre web repository (normalement appel√© **`web2`**) nomm√© **`/exercises/2.5`**.

Quand votre application est finalis√©e, veuillez faire un **`commit`** de votre code avec comme message : **`2.5 : run action within timer`**.

#### ü§ù Tips

- Quelle action doit √™tre programm√©e dans le temps ? Peut-√™tre celle en cas d'√©chec, lorsque le temps est √©coul√©...
- Quid si l'utilisateur r√©ussi √† cliquer suffisamment vite ? Peut-√™tre faut il annuler l'action programm√©e...


# <InternalPageTitle> Les intervalles de temps & actions r√©p√©t√©es </InternalPageTitle>

**`setInterval(f,t)`** permet l'ex√©cution d'une callback **`f`** tous les **`t`** ms.

**`clearInterval()`** permet de stopper les appels √† la callback qui ont √©t√© programm√©s via **`setInterval()`**.

On souhaiterait programmer une horloge, voici un simple exemple :

```html
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo : interval management to provide a clock</title>
  </head>
  <body>
    <span></span>
    <br />
    <button>Stop or resume the clock</button>
    <script src="./index.js"></script>
  </body>
</html>
```

```js numbered highlighting="6,11,22"
const btn = document.querySelector("button");
const clockHolder = document.querySelector("span");

btn.addEventListener("click", stopOrResumeClock);

var myIntervalId;

startClock();

function startClock() {
  myIntervalId = setInterval(printCurrentTime, 1000);
}

function printCurrentTime() {
  const now = new Date();
  const time = now.toLocaleTimeString();
  clockHolder.innerText = time;
}

function stopOrResumeClock() {
  if (myIntervalId) {
    clearInterval(myIntervalId);
    myIntervalId = undefined;
  } else startClock();
}
```

N'h√©sitez pas √† ex√©cuter ce code si vous le souhaitez en cr√©ant les 2 fichiers n√©cessaires.

La gestion d'intervalles, de cette fa√ßon, est l'anc√™tre des animations en JS !

Si vous souhaitez consulter la documentation MDN concernant la gestion d'√©v√©nements, afin d'approfondir certains √©l√©ments, la voici :

- [Introduction aux √©v√©nements](https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Building_blocks/Events) [[R.27]](/references/#r27)
- [Index & liste de tous les √©v√©nements](https://developer.mozilla.org/en-US/docs/Web/Events) [[R.28]](/references/#r28)

# <InternalPageTitle> Exercice 2.6 : s√©quence d'√©v√©nements diff√©r√©s dans le temps </InternalPageTitle>

Veuillez r√©aliser une application web permettant d'afficher un feu rouge.

Votre feu rouge devra continuellement alterner l'affichage de ce cycle de trois couleurs :
- rouge pendant 2 secondes
- orange pendant 2 secondes
- vert pendant 2 secondes
- orange pendant 2 secondes
- rouge pendant 2 secondes
- ...

Voila √† quoi pourrait ressembler votre application web :

<ScrollableImage name="red-light.gif" minWidth="308px" maxWidth="308px" />


Veuillez cr√©er un nouveau projet dans votre repository local et votre web repository (normalement appel√© **`web2`**) nomm√© **`/exercises/2.3`**.  Quand votre application est finalis√©e, veuillez faire un **`commit`** de votre code avec comme message : **`2.3 : timed events`**.

#### ü§ù Tips

- Vous avez besoin d'un container pour afficher une couleur.
  Vous pourriez utiliser la propri√©t√© **`style.backgroundColor`** d'une **`div`**.
- Comment afficher une **`div`** vide avec une bordure ? N'h√©sitez pas √† vous inspirer de ce morceau de code :
``` js
<div
  class="red"
  style="display: inline-block; min-width: 50px; min-height: 50px; border:1px solid black"
></div>
```
