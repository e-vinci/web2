---
title: "Module 4 : Service web & clients"
description: "CrÃ©ation de services web, de RESTful API & requÃªtes clientes"
---

# Module 4 : Service web & clients
Ce module vous offre principalement la crÃ©ation de services web et la mise en place de 
requÃªtes clientes pour tester des RESTful API.

<br/>

Voici les sujets traitÃ©s :
- a) [Introduction au backend](#a)
- b) [Introduction Ã  Node.js](#b)
    - b.1) [Introduction](#b1)
    - b.2) [Ou mettre du code Node.js ?](#b2)
    - b.3) [Les modules CommonJS](#b3)
    - b.4) [Introduction aux packages](#b4)



<br/>

# <a id="a"></a>a) Introduction au backend
## a.1) Frontend, backend, c'est quoi ?
Un **frontend**, c'est une application :
- qui s'exÃ©cute cÃ´tÃ© client, une IHM, qu'on pourrait aussi appeler UI ;
- qui est en direct interaction avc l'utilisateur ;
- implÃ©mentÃ©, dans ce cours-ci, en HTML / CSS / JS.

Un **backend**, c'est une application :
- qui s'exÃ©cute cÃ´tÃ© serveur ; 
- qui n'offre pas d'interaction directe avec l'utilisateur ;
- qui parfois met Ã  disposition le **frontend** ;
- qui parfois offre des opÃ©rations sur des donnÃ©es.

## a.2) RÃ´les principaux du backend
### a.2.1) Fourniture du frontend
Un des rÃ´les du backend est de fournir le frontend :
- **via un serveur de fichiers statiques** ; c'est la mise Ã  disposition des assets : fichiers HTML,
CSS, JS, images...
- **via la gÃ©nÃ©ration dynamique de pages HTML** ; c'est ce qui se passe quand le backend 
fait du Server Side Rendering (SSR), gÃ©nÃ©ralement dans le cadre de Multi Page Applications.  

Dans le cadre de ce cours, nous ne ferons pas de gÃ©nÃ©ration dynamique d'HTML cÃ´tÃ© serveur (ou SSR).  
Par contre, nous avons dÃ©jÃ  vu :
- comment faire de la gÃ©nÃ©ration dynamique d'HTML cÃ´tÃ© client (ou 
Client Side Rendering = CSR).
- mettre Ã  disposition notre frontend, notre IHM, Ã  l'aide d'un serveur de fichiers statiques : 
c'est ce que notamment fait le serveur de dÃ©veloppement de Webpack, il me Ã  disposition les assets 
permettant au browser d'exÃ©cuter l'application web.

### a.2.2) Fourniture d'opÃ©rations sur des ressources
Un autre rÃ´le important du backend est de mettre Ã  disposition des opÃ©rations sur des ressources,
c'est ce qu'on appelle les services web ou web API.

Il existe diffÃ©rents types de technologies et architectures web permettant d'implÃ©menter 
des web services, notamment :
- **RESTful API** ; c'est l'architecture qui actuellement est la plus utilisÃ©e et qui sera apprise dans 
le cadre de ce cours.
- **GraphQL API** ; c'est une technologie rÃ©cente qui permet de trÃ¨s rapidement crÃ©er des requÃªtes 
sur des ressources et qui a Ã©tÃ© crÃ©Ã©e par Facebook ; nous ne verrons pas cette technologie dans 
le cadre de ce cours.
- **SOAP API** ; c'est une faÃ§on ancienne de crÃ©er des opÃ©rations sur des ressources mettant en 
oeuvre de l'XML pour communiquer entre des applications clients / serveurs. Nous ne verrons 
pas cette technologie dans le cadre de ce cours.

### a.2.3) Autres rÃ´les du backend ?
Un backend peut offrir d'autres services, comme :
- **proxy** : intermÃ©diaire entre les clients demandant une ressource et le serveur fournissant 
cette ressource. On verra ce type de service, notamment pour masquer l'origine d'une requÃªte Ã  
une API.
- **reverse proxy** : c'est un serveur qui fait l'intermÃ©diaire avec d'autres serveurs, cachant 
au client qui est le vÃ©ritable serveur ayant traitÃ© de sa requÃªte. Par exemple, un proxy serveur 
peut mettre Ã  disposition des accÃ¨s Ã  des serveurs interne Ã  une entreprise (non visibles sur le web)
alors que le client interroge un serveur qui est visible sur le web.
- **serveur d'emails** ;
- ...

### a.2.3) Technologies backend possibles

Voici un exemple de technologies qui pourrait Ãªtre mises en oeuvre pour dÃ©velopper une application
backend :

<ScrollableImage name="techno.png" minWidth="586px" maxWidth="586px" />

  <figcaption>Technologies backend possibles</figcaption>

### a.2.4) Technologies backend sÃ©lectionnÃ©es pour ce cours

Voici les technologies qui ont Ã©tÃ© choisies pour Ãªtre mises en oeuvre 
pour dÃ©velopper une application backend en JS :

<ScrollableImage name="techno-course.png" minWidth="721px" maxWidth="721px" />

  <figcaption>Technologies backend en JS choisies pour ce cours</figcaption>

Nous allons utiliser Express comme framework pour rapidement dÃ©velopper des applications Node.js.

# <a id="b"></a>b) Introduction Ã  Node.js
## <a id="b1"></a> b.1) Introduction
Node.js est un environnement serveur open source permettant la crÃ©ation d'outils 
et applications cÃ´tÃ© serveur en JS.  
Node.js offre une utilisation optimale des ressources des serveurs sans dÃ©pendance 
Ã  un serveur http externe, tout en Ã©tant multiplateforme (Windows, Linux, Macâ€¦).

Pour le dÃ©veloppement d'IHM de faÃ§on modernes, vous avez dÃ©jÃ  installÃ© l'environnement
Node.js. Mais si Ã§a n'est pas installÃ©, il est important que vous installiez l'environnement 
[Node.js en version LTS](https://nodejs.org/en/) [[R.34]](/references/#r34).

Vous ne devez pas apprendre un nouveau langage pour dÃ©velopper des applications backend, 
Node.js, c'est du JS.  
Si vous avez besoin d'un rappel du langage, vous pouvez le faire ici : [Introduction au langage JS](/intro/#e).

TrÃ¨s souvent, Node.js est codÃ© en JS conforme au standard CommonJS.
La gestion des modules est diffÃ©rente du JS conforme au standard ECMAScript, telle que nous avons
appris pour du JS cÃ´tÃ© browser.

MÃªme s'il est possible d'Ã©crire du Node.js conforme au standard ECMAScript, la majoritÃ© du code 
que vous trouverez sur le web sera conforme Ã  CommonJS.

DÃ¨s lors, nous allons vous expliquer plus tard comment gÃ©rer des modules en Node.js conforme au 
standard CommonJS.

## <a id="b2"></a> b.2) Ou mettre du code Node.js ?
### b.2.1) Directement dans un terminal
Il est possible d'Ã©crire du code Node.js directement dans un terminal.

Pour rappel, nous vous conseillons d'utiliser Git Bash comme terminal au sein de VS Code. 

Vous devriez dÃ©jÃ  avoir configurÃ© VS Code pour avoir comme Terminal par dÃ©faut 
Git Bash. Si Ã§a n'est pas fait, nous vous rappelons la procÃ©dure :
- Vous devez avoir installÃ© Git sur votre machine.
- Clicquez Ã  droite du **+** au sein d'un terminal ouvert dans VS Code, 
clic sur **Select Default Profile**, puis sÃ©lectionnez "Git Bash".
Tous les prochains terminaux que vous ouvrirez le seront sous Git Bash, nettement plus colorÃ© 
et intÃ©ressant que les autres terminaux ğŸ˜.

<ScrollableImage name="terminal-2.png" minWidth="933px" maxWidth="933px" />

<figcaption>Choix du terminal par dÃ©faut</figcaption>

Veuillez tester du code Node.js directement dans un terminal en tapant 
cela au sein d'un terminal de VS Code :

```bash
node
```

Vous avez maintenant accÃ¨s au terminal de Node.js.  
Vous pouvez tenter une opÃ©ration mathÃ©matique de votre choix, comme par exemple :
**2 * Math.PI**

Incroyable mais vrai, vous avez maintenant accÃ¨s Ã  une nouvelle calculatrice sur tous les appareils 
oÃ¹ vous avez Node.js installÃ©. Et si Node.js n'est pas installÃ©, pas de panique, 
la console de votre Browser pourra toujours vous aider ğŸ˜‰.

Quand vous souhaitez sortir de l'interprÃ©teur de commandes de Nodes, il faut taper :
- soit deux fois **`CTRL c`**
- soit **`CTRL d`**

### b.2.2) Dans un script
Nous Ã©crivons gÃ©nÃ©ralement le code Node.js au sein d'un script externe.

Dans votre repo **web2**, veuillez crÃ©er un rÃ©pertoire **/tutorials/node-start** et y 
ajouter le fichier **start.js** contenant ce code-ci :

```js
class Car {
  constructor(brand, model) {
    this.brand = brand;
    this.model = model;
    this.id = Math.random();
  }

  getDescription() {
    return `Car's description : ${this.brand}, ${this.model} , ID:${this.id}`;
  }
}

const dacia = new Car('Dacia', 'Sandero');

console.log( dacia.getDescription() );
```

Pour lancer une application Node.js, il suffit de taper dans un terminal : **`node nomScript`** 
(**`.js`** est optionnel).

Donc pour lancer le script crÃ©Ã© ci-dessus, veuillez ouvrir un terminal au bon endroit.  
Pour rappel, Il est possible de faire un clic droit dans l'Explorer de VS Code 
sur le rÃ©pertoire **node-start**, **Open in Integrated Terminal** pour ouvrir un terminal 
Ã  l'endroit souhaitÃ©.

Il ne vous reste plus qu'Ã  taper :

```bash
node start # or node start.js
```

Voila, c'est une simple application Node.js qui affiche un message dans le terminal.

## <a id="b3"></a> b.3) Les modules CommonJS
### b.3.1) Introduction
Un module est une librairie JS fournissant des objets.
Comme en JS tout est objet, un module met donc Ã  disposition des fonctions, des constantes, des variables...

### b.3.2) CrÃ©ation d'un module
Pour crÃ©er un module, il suffit de crÃ©er un script JS **nomModule.js** et d'exporter des
objets au sein de ce module via **module.exports** ou **exports**.

### b.3.3) Exporter des objets
#### b.3.3.1) Introduction
Il existe plusieurs faÃ§ons d'exporter des objets, soit Ã  la volÃ©e, soit Ã  la fin d'un script.

ğŸ‘ Nous vous recommandons de faire vos exports Ã  la fin du script, cela rend les scripts plus 
lisibles. 

Nous allons nÃ©anmoins voir toutes les faÃ§ons d'exporter des objets en CommonJS, car vous trouverez
de tout sur le web.

On exporte toujours un seul objet principal dans un module. Cet objet peut bien sÃ»r contenir 
une multitude d'objets via ses propriÃ©tÃ©s.

#### b.3.3.2) Export Ã  la fin d'un script
C'est la faÃ§on la plus propre d'exporter un seul objet :

```js
module.exportsÂ =Â router;
```

C'est l'Ã©quivalent d'un "default export" tel que vu en ECMAScript.

S'il y a plusieurs objets Ã  exporter, voici la faÃ§on recommandÃ©e de le faire : 

```js
module.exportsÂ =Â {authorize,Â usersÂ };
```

C'est l'Ã©quivalent d'un "Named export" tel que vu en ECMAScript.

#### b.3.3.3) Export Ã  la volÃ©e

Il est possible de faire des exports Ã  la volÃ©e, c'est Ã  dire d'exporter des objets 
au fur et Ã  mesure qu'ils sont initialisÃ©s.

Voici la version longue :

```js
module.exports.authorizeÂ =Â authorize;
module.exports.usersÂ =Â usersÂ ;
```

Il est aussi possible d'Ã©courter une export Ã  la volÃ©e : 
```js
exports.authorizeÂ =Â authorize;
exports.usersÂ =Â usersÂ ;
```

Voici quelques prÃ©cisions :
- **`module.exports`** : c'est la rÃ©fÃ©rence de l'objet retournÃ©e par l'appel de **`required()`** 
(mÃ©thode qui sera utilisÃ©e pour l'import).
- **`exports`** : c'est la rÃ©fÃ©rence vers **`module.exports`**, **`exports`** 
n'est pas retournÃ© par l'appel de **`required()`**.

âš¡ Il faut faire attention au mauvais usage de l'utilisation de **`exports`**. 
Voici une mauvaise utilisation :

```js
exportsÂ =Â {Â authorize,Â usersÂ };Â /*Â exportsÂ hasÂ aÂ newÂ reference,Â 
                                   itÂ isÂ noÂ longerÂ linkedÂ toÂ module.exports */
```

### b.3.4) Importer des objets
#### b.3.4.1) Introduction
Pour utiliser des objets (fonctions, constantes, objets, classes...) au sein d'un script JS 
provenant de modules, on le fait Ã  l'aide de la fonction **`required()`** et du 
chemin vers le module Ã  utiliser.

Il est possible d'importer tant des objets de modules que l'on a crÃ©Ã© soi-mÃªme, 
que de packages mis Ã  disposition via un gestionnaire de packages.

#### b.3.4.2) Import d'un module
Lorsqu'un seul objet a Ã©tÃ© exportÃ©, on l'importe en lui donnant le nom que l'on souhaite 
Ã  l'import et en indiquant le chemin vers le module Ã  utiliser.

```js
constÂ pizzaRouterÂ =Â require('./routes/pizzas');
```

Lorsque plusieurs objets ont Ã©tÃ© exportÃ©s, on importe ce que l'on souhaite en utilisant 
des accolades et en indiquant le chemin vers le module Ã  utiliser.

```js
constÂ {Â users,Â authorizeÂ }Â =Â require('../utils/auths');
```

#### b.3.4.2) Import d'un package
Il est aussi possible d'importer des objets de packages offerts par la 
communautÃ© via votre gestionnaire de package.
Pour ce faire, il est juste nÃ©cessaire d'indiquer le nom du package lors de l'import.

Si un seul objet est exportÃ© par un package, voici un exemple de comment le rÃ©cupÃ©rer :

```js
//Â moduleÂ integratedÂ toÂ theÂ runtimeÂ environment
constÂ httpÂ =Â require('http');
//Â moduleÂ following package installation
constÂ shortidÂ =Â require('shortid');
```

## <a id="b4"></a> b.4) Introduction aux packages
### b.4.1) Introduction
Dans le cadre du dÃ©veloppement d'IHM modernes, au module 2, nous avons dÃ©couvert le gestionnaire 
de packages de Node.js. Nous allons rÃ©sumer les concepts importants ci-dessous.

### b.4.2) Gestionnaire de packages
**npm** est le gestionnaire de packages de Node.js. 

On peut faire des recherches de packages qui serait utiles Ã  nos application web 
sur [npmjs.com](https://www.npmjs.com/) [[R.48]](/references/#r48).

### b.4.3) Fichier de configuration d'un projet
Tous les packages associÃ©s Ã  une app, ses dÃ©pendances, sont donnÃ©es dans le fichier :
**package.json**.

C'est le fichier qui dÃ©crit la configuration d'un projet JS.

On peut manuellement crÃ©er ce fichier Ã  l'aide de la commande **`npm init`** 
ou **`npm init -y`** si l'on souhaite quelque chose de plus interactif.

Voici un exemple de fichier **package.json** :

```json
{
  "name": "api2",
  "version": "0.0.0",
  "private": true,
  "scripts": {
    "debug": "npm run dev",
    "dev": "nodemon ./bin/www",
    "start": "node ./bin/www",
    "lint": "eslint **/*.js",
    "lint:fix": "npm run lint -- --fix"
  },
  "nodemonConfig": {
    "ignore": [
      "data/*"
    ],
    "exec": "npm run lint && node"
  },
  "dependencies": {
    "cookie-parser": "~1.4.4",
    "debug": "~2.6.9",
    "express": "~4.16.1",
    "morgan": "~1.9.1"
  },
  "devDependencies": {
    "eslint": "^8.19.0",
    "eslint-config-airbnb-base": "^15.0.0",
    "nodemon": "^2.0.19",
    "prettier-airbnb-config": "^1.0.0"
  },
  "author": "e-Baron"
}
```

Lors de l'installation d'un package, 
celui-ci s'ajoute Ã  la liste des dÃ©pendances.  
Ainsi, si des dÃ©veloppeurs trouvent votre projet sur Git,
ils n'auront qu'Ã  exÃ©cuter **`npm i`** afin d'installer toutes les dÃ©pendances.

C'est dans le rÃ©pertoire **node_modules** que toutes les dÃ©pendances seront installÃ©es. 
Ces dÃ©pendances peuvent Ãªtre trÃ¨s volumineuses. C'est donc important de ne jamais 
mettre ce dossier sur vos web repository, via Git.  
Pour ce faire, n'oubliez pas d'inclure un fichier **.gitignore** dans vos repos 
pour ignore **node_modules**.

### b.4.4) Installer un package
Pour installer un package (ou une dÃ©pendance), 
il suffit de faire : **`npm i nomDuPackage`** ou **`npm install nomDuPackage`**.

### b.4.5) DÃ©pendances installÃ©es
On a vu que **`npm i`** permet d'installer toutes les dÃ©pendances se trouvant dans 
**package.json**, ainsi que toutes les dÃ©pendances de ces dÃ©pendances...

L'arbre exact des dÃ©pendances installÃ©es, numÃ©ro de version..., se trouve dans 
**package-lock.json**. Ce fichier est gÃ©nÃ©rÃ© automatiquement pour chaque opÃ©ration
modifiant **node_modules** ou **package.json**.

âš¡ Si un fichier **package-lock.json** est compris dans un repo, lorsque vous introduirez 
**`npm i`** pour installer toutes les dÃ©pendances, npm installera les mÃªmes versions que celles 
se trouvant dans **package-lock.json**. Cela peut poser des problÃ¨mes si votre environnement 
Node.js est en version diffÃ©rente. En cas de souci, pensez Ã  effacer le rÃ©pertoire **node_modules** 
et le fichier **package-lock.json** avant de relancer l'installation de toutes les dÃ©pendances.

### b.4.6) Localisation d'un module ou package par Node
Node va chercher dans tous les chemins spÃ©cifiÃ©s dans **module.paths** : **node_modules**, **.**...
lorsque **`required()`** est appelÃ©.

### b.4.7) Mise Ã  jour des packages vers leur derniÃ¨re version
La mise Ã  jour de toutes les dÃ©pendances peut parfois amener Ã  des gros soucis.

Vous pouvez tenter de mettre Ã  jour tous vos package en suivant la documentation de Node.js :
[Update all the Node.js dependencies to their latest version](https://nodejs.dev/learn/update-all-the-nodejs-dependencies-to-their-latest-version)
[[R.49]](/references/#r49)

Mais attention, certains packages parfois subissent des "breaking changes", 
ce qui impose que vous deviez faire migrer votre code avant que celui-ci soit fonctionnel.

Nous vous recommandons donc, si vous rencontrer un problÃ¨me lors de la mise Ã  jour de tous vos 
packages d'un coup, de revenir Ã  la situation initiale, et de faire l'upgrade de chaque 
package listÃ© dans **package.json** individuellement.